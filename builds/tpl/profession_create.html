{{ block "content" .data}}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">新建{{index .module.I18nName .zone}}</h1>
</div>
<div class="select_content input-group mb-3">
    <div class="input-group-prepend">
        <label class="input-group-text" for="drivers">Drivers</label>
    </div>
    <select class="custom-select" id="drivers">
        {{- range $i,$t := (index .data)}}
            {{- if eq $i 0}}
                <option value="{{$t}}" selected>{{$t}}</option>
            {{- else }}
                <option value="{{$t}}">{{$t}}</option>
            {{- end}}
        {{- end }}
    </select>
</div>
<div id="form"></div>
{{end}}
{{- block "script" . -}}
<link href="/css/spectre-icons.css" rel="stylesheet">
<script type="text/javascript" src="/js/jsoneditor.min.js"></script>
<script>
    $(document).ready(function () {
        JsonEditor.init('bootstrap4', "spectre", {
            "button" : {
                "submit" : function (editor, e) {
                    const errors = editor.jsoneditor.validate();
                    if (errors.length) {
                        common.message(errors[0].message, "danger")
                    }
                    else {
                        JsonEditor.create("/api/{{.name}}/", editor.jsoneditor.getValue())
                    }
                }
            }
        })
        let select = $("#drivers")
        let editor = JsonEditor.getEditor("form", "{{.name}}", "/api/render/{{.name}}/"+select.val(), {
            prompt_before_delete:true,
        })
        $('.select_content').on('change', "select#drivers", function () {
            let value = $(this).val();
            editor = JsonEditor.updateSchema(editor, "/api/render/{{.name}}/"+value, "{{.name}}")
        });
    });
</script>

{{- end -}}