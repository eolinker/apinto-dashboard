{{- block "header" . -}}
<link href="/css/bootstrap-table.min.css" rel="stylesheet"  rel="stylesheet">
<link href="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/reorder-rows/bootstrap-table-reorder-rows.css" rel="stylesheet">
{{- end -}}
{{ block "content" .}}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">全局插件</h1>
    <button type="button" id="create_btn"  class="btn btn-primary">Add</button>
</div>

<table
        id="table"
        data-toggle="table"
        data-flat="true"
        data-url="/api/{{.name}}/"
        data-reorderable-rows="true"
        data-use-row-attr-func="true"
        data-response-handler="responseHandler">
    <caption>List of {{.name}}</caption>
    <thead>
    <tr>
        {{- range $i,$t := (index .data.Title .zone)}}
        <th data-field="{{index $.data.Fields $i}}">{{ $t}}</th>
        {{- end }}
        <th data-field="operate" data-formatter="operateFormatter" data-events="operateEvents">操作</th>
    </tr>
    </thead>

</table>

<!--<div class="wrapper" style="display: block">-->
<!--    <div class="wrapper_header">-->
<!--        <span class="wrapper_title">配置详情</span>-->
<!--        <button class="wrapper_button btn btn_default" >关闭</button>-->
<!--        <br>-->
<!--    </div>-->
<!--    <div class="wrapper_body">-->
<!--        adfasfasfdfadsfasfaf-->
<!--    </div>-->
<!--    <div class="wrapper_footer row justify-content-between">-->
<!--        <div class="col-4">-->
<!--            <button type="button" class="btn btn-outline-secondary">取消</button>-->
<!--        </div>-->
<!--        <div class="col-4" style="text-align: right">-->
<!--            <button type="button" class="btn btn-primary">提交</button>-->
<!--        </div>-->
<!--    </div>-->

<!--</div>-->
{{end}}

{{block "script" .}}
<script src="/js/bootstrap-table.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tablednd@1.0.5/dist/jquery.tablednd.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.19.1/dist/extensions/reorder-rows/bootstrap-table-reorder-rows.min.js"></script>
<script>
    let $table = $('#table')
    $(document).ready(function(){
        $table.bootstrapTable('refreshOptions', {
            onReorderRow: function (newData) {
                console.log(newData)
            }
        })
    })
    function responseHandler(res) {
        return res.data["plugins"]
    }
    $("#create_btn").click(function () {
        common.message("暂未实现", "info")
    })

    function operateFormatter(value, row, index) {
        return [
            '<a class="edit" href="javascript:void(0)" title="edit">',
            '配置',
            '</a>  ',
            '<a class="remove" href="javascript:void(0)" title="remove">',
            '删除',
            '</a>'
        ].join('')
    }

    function updateData(data){
        dashboard.update("/api/{{.name}}", {
            "plugins":data
        }, function (res){
            if(res.code !== 200){
                http.handleError(res, "更新失败")
                return
            }
        }, function (res){
            http.handleError(res, "更新失败")
        })
    }
    function updateRow(table, index, data){
        table.bootstrapTable('updateRow', {
            index: index,
            row: data
        })
    }
    function removeRow(table, field, value){

        table.bootstrapTable('remove', {
            field: field,
            values: [value]
        })
    }
    window.operateEvents = {
        'click .edit': function (e, value, row, index) {
            row.name = "test"
            console.log(JSON.stringify($table.bootstrapTable('getData')))
        },
        'click .remove': function (e, value, row, index) {
            let msg ="确认删除 "+row.name+" {{index .module.I18nName .zone}}?"
            common.confirm("删除{{index .module.I18nName .zone}}", msg, function (){
                // dashboard.delete("/api/{{.name}}/"+row.name, function (res) {
                //     if(res.code === 200){
                //         common.message("删除成功", "danger")
                //         $table.bootstrapTable('remove', {
                //             field: 'id',
                //             values: [row.id]
                //         })
                //         return
                //     }
                //     http.handleError(res, "删除失败")
                // }, function (res) {
                //     http.handleError(res, "删除失败")
                // })

                removeRow($table, 'id', row.id)
                console.log(JSON.stringify($table.bootstrapTable('getData')))
            }, null)
        },
    }
    // $(".wrapper_button").click(function (){
    //     $(".wrapper").hide(200)
    //     $(".wrapper_title").text("")
    //     $("#wrapper_table_body").html("")
    // })
</script>
{{end}}