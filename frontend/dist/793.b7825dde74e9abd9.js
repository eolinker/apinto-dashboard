"use strict";(self.webpackChunkapinto=self.webpackChunkapinto||[]).push([[793],{2793:(Qe,S,o)=>{o.r(S),o.d(S,{UpstreamModule:()=>Je});var T=o(6895),l=o(9132),e=o(4650),v=o(8513),z=o(6084);const O=["tab1Tpl"],k=["tab2Tpl"];function P(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"\u4e0a\u7ebf\u7ba1\u7406"),e.qZA())}function V(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"\u670d\u52a1\u4fe1\u606f"),e.qZA())}let Y=(()=>{class i{constructor(t,s,a,r,m,u){this.baseInfo=t,this.router=s,this.activateInfo=a,this.cdRef=r,this.elem=m,this.renderer=u,this.tab1Tpl="\u73af\u5883\u53d8\u91cf",this.tab2Tpl="\u8bc1\u4e66\u7ba1\u7406",this.serviceName="",this.options=[],this.tabOptions=[],this.selectedIndex=0,this.nowUrl=this.router.routerState.snapshot.url}ngOnInit(){this.serviceName=this.baseInfo.allParamsInfo.discoveryName,this.serviceName||this.router.navigate(["/"])}ngAfterViewInit(){this.tabOptions=[{title:this.tab1Tpl,routerLink:".",queryParamsHandling:"merge"},{title:this.tab2Tpl,routerLink:"message",queryParamsHandling:"merge"}],this.cdRef.detectChanges()}ngAfterViewChecked(){document.getElementsByClassName("ant-tabs-ink-bar")[0]?.removeAttribute("hidden")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(v.D),e.Y36(l.F0),e.Y36(l.gz),e.Y36(e.sBO),e.Y36(e.SBq),e.Y36(e.Qsj))},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-service-discovery-content"]],viewQuery:function(t,s){if(1&t&&(e.Gf(O,7,e.Rgc),e.Gf(k,7,e.Rgc)),2&t){let a;e.iGM(a=e.CRH())&&(s.tab1Tpl=a.first),e.iGM(a=e.CRH())&&(s.tab2Tpl=a.first)}},decls:8,vars:3,consts:[[1,"content-tabs-fixed"],[3,"nzLinkRouter","nzSelectedIndex","nzOptions","nzSelectedIndexChange"],["tab1Tpl",""],["tab2Tpl",""],[1,"inside-content-fixed-top-51"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"eo-ng-tabs",1),e.NdJ("nzSelectedIndexChange",function(r){return s.selectedIndex=r}),e.qZA(),e.YNc(2,P,2,0,"ng-template",null,2,e.W1O),e.YNc(4,V,2,0,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(6,"div",4),e._UZ(7,"router-outlet"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("nzLinkRouter",!0)("nzSelectedIndex",s.selectedIndex)("nzOptions",s.tabOptions))},dependencies:[z.n4,l.lC],encapsulation:2}),i})();var c=o(4006),f=o(1461),d=o(9561),h=o(3),g=o(2266),D=o(8344),U=o(4944),C=o(2366),F=o(4162),y=o(3679),p=o(6704),b=o(999);const J=["environmentRef"];function Q(i,n){1&i&&(e.ynx(0),e._uU(1,"\u82f1\u6587\u6570\u5b57\u4e0b\u5212\u7ebf\u4efb\u610f\u4e00\u79cd\uff0c\u9996\u5b57\u6bcd\u5fc5\u987b\u4e3a\u82f1\u6587"),e.BQk())}function R(i,n){1&i&&(e.ynx(0),e._uU(1,"\u5fc5\u586b\u9879"),e.BQk())}function q(i,n){if(1&i&&(e.YNc(0,Q,2,0,"ng-container",15),e.YNc(1,R,2,0,"ng-container",15)),2&i){const t=n.$implicit;e.Q6J("ngIf",t.hasError("pattern")),e.xp6(1),e.Q6J("ngIf",t.hasError("required"))}}let N=(()=>{class i{constructor(t,s,a,r,m){this.message=t,this.api=s,this.router=a,this.fb=r,this.appConfigService=m,this.editPage=!1,this.serviceName="",this.startValidateDynamic=!1,this.baseData="",this._baseData=null,this.tempForDynamic="MockDynamic",this.canBeSave=!1,this.useEnvVar=!1,this.nzDisabled=!1,this.createServiceForm={name:"",desc:"",driver:"nacos",config:{useVariable:!1,addrsVariable:"",addrs:[],params:[{key:"",value:""}]}},this.driverList=[],this.autoTips=f.Sm,this.submitButtonLoading=!1,this.validateForm=new c.cw({}),this.showDynamicTips=!1,this.validateForm=this.fb.group({name:["",[c.kI.required,c.kI.pattern("^[a-zA-Z][a-zA-Z0-9/_]*")]],desc:[""],driver:["nacos",[c.kI.required]]}),this.appConfigService.reqFlashBreadcrumb([{title:"\u670d\u52a1\u53d1\u73b0",routerLink:"upstream/discovery"},{title:"\u65b0\u5efa\u670d\u52a1"}])}ngOnInit(){this.editPage?(this.appConfigService.reqFlashBreadcrumb([{title:"\u670d\u52a1\u53d1\u73b0",routerLink:"upstream/discovery"},{title:"\u670d\u52a1\u4fe1\u606f"}]),this.validateForm.controls.driver.disable(),this.validateForm.controls.name.disable(),this.getServiceMessage()):this.getDriverList()}disabledEdit(t){this.nzDisabled=t}getDriverList(){this.api.get("discovery/drivers").subscribe(t=>{0===t.code&&(t.data.drivers.forEach(s=>{this.driverList.push({label:s.name,value:s.name,render:s.render}),s.name===this.validateForm.controls.driver.value&&(this.baseData=s.render)}),this.driverList=[...this.driverList])})}changeBasedata(){this.driverList.forEach(t=>{this.validateForm.controls.driver.value===t.label&&(this.baseData=t.render)})}getServiceMessage(){this.api.get("discovery",{name:this.serviceName}).subscribe(t=>{0===t.code&&(this.validateForm.controls.name.setValue(t.data.discovery.name),this.validateForm.controls.desc.setValue(t.data.discovery.desc),this.validateForm.controls.driver.setValue(t.data.discovery.driver),this.createServiceForm=t.data.discovery,(!this.createServiceForm.config.params||0===this.createServiceForm.config.params.length)&&(this.createServiceForm.config.params=[{key:"",value:""}]),this.createServiceForm.config.addrs=this.createServiceForm.config.addrs?this.createServiceForm.config.addrs:[],this.createServiceForm.config.addrsVariable=this.createServiceForm.config.addrsVariable?this.createServiceForm.config.addrsVariable:"",this.getDriverList())})}getDataFromDynamicComponent(t){if(t){if(!t.config.useVariable){if(0===t.config.addrs.length)return void(this.canBeSave=!1);{let s=!1;for(const a in t.config.addrs)t.config.addrs[a]&&(s=!0);if(!s)return void(this.canBeSave=!1)}}if(t.config.useVariable&&!t.config.addrsVariable)return void(this.canBeSave=!1);this.canBeSave=!0}}saveService(){if(this.startValidateDynamic=!0,this.showDynamicTips=!this.canBeSave,(this.validateForm.valid||this.checkValidForm())&&this.canBeSave){if(this.createServiceForm.config.params.length>0){const t=[];for(const s in this.createServiceForm.config.params)this.createServiceForm.config.params[s].key&&this.createServiceForm.config.params[s].value&&t.push({key:this.createServiceForm.config.params[s].key,value:this.createServiceForm.config.params[s].value});this.createServiceForm.config.params=t}else this.createServiceForm.config.params=[];this.createServiceForm.config.addrs=null===this.createServiceForm.config.addrs||this.createServiceForm.config.useVariable?[]:Array.from(new Set(this.createServiceForm.config.addrs)),this.createServiceForm.config.addrsVariable=null!==this.createServiceForm.config.addrsVariable&&this.createServiceForm.config.useVariable?this.createServiceForm.config.addrsVariable:"",this.createServiceForm.config.useVariable=null!==this.createServiceForm.config.useVariable&&this.createServiceForm.config.useVariable,this.submitButtonLoading=!0,this.editPage?this.api.put("discovery",{...this.validateForm.value,config:this.createServiceForm.config},{name:this.validateForm.controls.name.value}).subscribe(t=>{this.submitButtonLoading=!1,0===t.code&&(this.message.success(t.msg||"\u4fee\u6539\u670d\u52a1\u6210\u529f",{nzDuration:1e3}),this.backToList())}):this.api.post("discovery",{...this.validateForm.value,config:this.createServiceForm.config}).subscribe(t=>{this.submitButtonLoading=!1,0===t.code&&(this.message.success(t.msg||"\u65b0\u5efa\u670d\u52a1\u6210\u529f",{nzDuration:1e3}),this.backToList())})}else Object.values(this.validateForm.controls).forEach(t=>{t.invalid&&(t.markAsDirty(),t.updateValueAndValidity({onlySelf:!0}))})}checkValidForm(){for(const t in this.validateForm.controls)if(this.validateForm.controls[t].invalid)return!1;return!0}backToList(){this.router.navigate(["/","upstream","discovery"])}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(d.VY),e.Y36(h.s),e.Y36(l.F0),e.Y36(c.QS),e.Y36(g.a))},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-service-discovery-create"]],viewQuery:function(t,s){if(1&t&&e.Gf(J,7,e.Rgc),2&t){let a;e.iGM(a=e.CRH())&&(s.environmentRef=a.first)}},inputs:{editPage:"editPage",serviceName:"serviceName"},decls:30,vars:22,consts:[[1,"mt-formtop"],["nz-form","","autocomplete","off",3,"nzNoColon","nzAutoTips","formGroup"],["nzRequired","",3,"nzSpan"],[3,"nzSpan","nzErrorTip"],["name","name","required","","eo-ng-input","","formControlName","name","placeholder","\u82f1\u6587\u6570\u5b57\u4e0b\u5212\u7ebf\u4efb\u610f\u4e00\u79cd\uff0c\u9996\u5b57\u6bcd\u5fc5\u987b\u4e3a\u82f1\u6587","eoNgUserAccess","upstream/discovery",1,"w-INPUT_NORMAL"],["nameErrorTpl",""],[3,"nzSpan"],["name","desc","rows","3","eo-ng-input","","formControlName","desc","placeholder","\u8bf7\u8f93\u5165","eoNgUserAccess","upstream/discovery",1,"w-INPUT_NORMAL"],["name","driver","required","","formControlName","driver","eoNgUserAccess","upstream/discovery",1,"w-INPUT_NORMAL",3,"nzOptions","nzDisabled","ngModelChange","disabledEdit"],[1,"mb-0"],["ngDefaultControl","","name","dynamic","id","dynamic",1,"form-input","dynamic_area","pb-[8px]",3,"apiData","baseData","nzDisabled","startValidate","apiDataChange"],[1,"mb-0","sticky","bg-white","bottom-0","py-mbase","z-50"],[3,"nzOffset","nzSpan"],["type","submit","eo-ng-button","","eoNgUserAccess","upstream/discovery",1,"ant-btn-primary",3,"nzLoading","click"],["eo-ng-button","",1,"ml-btnybase",3,"click"],[4,"ngIf"]],template:function(t,s){if(1&t&&(e.TgZ(0,"div",0)(1,"form",1)(2,"nz-form-item")(3,"nz-form-label",2),e._uU(4,"\u6ce8\u518c\u4e2d\u5fc3\uff1a"),e.qZA(),e.TgZ(5,"nz-form-control",3),e._UZ(6,"input",4),e.YNc(7,q,2,2,"ng-template",null,5,e.W1O),e.qZA()(),e.TgZ(9,"nz-form-item")(10,"nz-form-label",6),e._uU(11,"\u63cf\u8ff0\uff1a"),e.qZA(),e.TgZ(12,"nz-form-control",6),e._UZ(13,"textarea",7),e.qZA()(),e.TgZ(14,"nz-form-item")(15,"nz-form-label",2),e._uU(16,"\u670d\u52a1\u7c7b\u578b\uff1a"),e.qZA(),e.TgZ(17,"nz-form-control",6)(18,"eo-ng-select",8),e.NdJ("ngModelChange",function(){return s.changeBasedata()})("disabledEdit",function(r){return s.disabledEdit(r)}),e.qZA()()(),e.TgZ(19,"nz-form-item",9)(20,"nz-form-label",2),e._uU(21,"\u914d\u7f6e\u4fe1\u606f\uff1a"),e.qZA(),e.TgZ(22,"nz-form-control",6)(23,"dynamic-component",10),e.NdJ("apiDataChange",function(r){return s.createServiceForm=r})("apiDataChange",function(r){return s.getDataFromDynamicComponent(r)}),e.qZA()()(),e.TgZ(24,"nz-form-item",11)(25,"nz-form-control",12)(26,"button",13),e.NdJ("click",function(){return s.saveService()}),e._uU(27),e.qZA(),e.TgZ(28,"button",14),e.NdJ("click",function(){return s.backToList()}),e._uU(29," \u53d6\u6d88 "),e.qZA()()()()()),2&t){const a=e.MAs(8);e.xp6(1),e.Q6J("nzNoColon",!0)("nzAutoTips",s.autoTips)("formGroup",s.validateForm),e.xp6(2),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",14)("nzErrorTip",a),e.xp6(5),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",14),e.xp6(3),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",14),e.xp6(1),e.Q6J("nzOptions",s.driverList)("nzDisabled",s.nzDisabled),e.xp6(2),e.Q6J("nzSpan",5),e.xp6(2),e.Q6J("nzSpan",14),e.xp6(1),e.Q6J("apiData",s.createServiceForm)("baseData",s.baseData)("nzDisabled",s.nzDisabled)("startValidate",s.startValidateDynamic),e.xp6(2),e.Q6J("nzOffset",5)("nzSpan",14),e.xp6(1),e.Q6J("nzLoading",s.submitButtonLoading),e.xp6(1),e.hij(" ",s.editPage?"\u63d0\u4ea4":"\u4fdd\u5b58"," ")}},dependencies:[T.O5,D.Hf,c._Y,c.Fj,c.JJ,c.JL,c.Q7,U._,C.oO,F.qK,y.t3,y.SK,p.Lr,p.Nx,p.iK,p.Fd,c.sg,c.u,b.g],encapsulation:2}),i})();var B=o(7504);const x=[{title:"\u4e0a\u6e38\u540d\u79f0"},{title:"\u534f\u8bae\u7c7b\u578b"},{title:"\u670d\u52a1\u7c7b\u578b"},{title:"\u5730\u5740"},{title:"\u66f4\u65b0\u65f6\u95f4"},{title:"\u64cd\u4f5c",right:!0}],H=[{key:"name",copy:!0},{key:"scheme"},{key:"serviceType"},{key:"config",copy:!0},{key:"updateTime"},{type:"btn",right:!0,btns:[{title:"\u67e5\u770b"},{title:"\u5220\u9664"}]}],w=[{label:"HTTP",value:"HTTP"},{label:"HTTPS",value:"HTTPS"}],G=[{label:"round-robin",value:"round-robin"},{label:"ip-hash",value:"ip-hash"}],j=[{title:"\u670d\u52a1\u540d\u79f0"},{title:"\u670d\u52a1\u7c7b\u578b"},{title:"\u63cf\u8ff0"},{title:"\u66f4\u65b0\u65f6\u95f4"},{title:"\u64cd\u4f5c",right:!0}],X=[{key:"name",copy:!0},{key:"driver"},{key:"desc"},{key:"updateTime"},{type:"btn",right:!0,btns:[{title:"\u67e5\u770b"},{title:"\u5220\u9664"}]}];var A=o(7706),_=o(2663);let W=(()=>{class i{constructor(t,s,a,r,m){this.message=t,this.modalService=s,this.api=a,this.router=r,this.appConfigService=m,this.nzDisabled=!1,this.serviceName="",this.serviceNameForSear="",this.servicesList=[],this.servicesTableHeadName=[...j],this.servicesTableBody=[...X],this.serviceTableClick=u=>{this.router.navigate(["/","upstream","discovery","content",u.data.name])},this.appConfigService.reqFlashBreadcrumb([{title:"\u670d\u52a1\u53d1\u73b0",routerLink:"upstream/discovery"}])}ngOnInit(){this.getServicesList(),this.servicesTableBody[4].btns[0].click=t=>{this.router.navigate(["/","upstream","discovery","content",t.data.name])},this.servicesTableBody[4].btns[1].disabledFn=(t,s)=>this.nzDisabled||!s.data.isDelete,this.servicesTableBody[4].btns[1].click=t=>{this.delete(t.data)}}getServicesList(){this.api.get("discoveries",{name:this.serviceNameForSear}).subscribe(t=>{0===t.code&&(this.servicesList=t.data.discoveries,this.serviceName=this.serviceNameForSear)})}disabledEdit(t){this.nzDisabled=t}addService(){this.router.navigate(["/","upstream","discovery","create"])}delete(t,s){s?.stopPropagation(),this.modalService.create({nzTitle:"\u5220\u9664",nzContent:"\u8be5\u6570\u636e\u5220\u9664\u540e\u5c06\u65e0\u6cd5\u627e\u56de\uff0c\u8bf7\u786e\u8ba4\u662f\u5426\u5220\u9664\uff1f",nzClosable:!0,nzClassName:"delete-modal",nzWidth:B.G_,nzOkDanger:!0,nzOnOk:()=>{this.deleteDiscovery(t.name)}})}deleteDiscovery(t){this.api.delete("discovery",{name:t}).subscribe(s=>{0===s.code&&(this.getServicesList(),this.message.success(s.msg||"\u5220\u9664\u6210\u529f!",{nzDuration:1e3}))})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(d.VY),e.Y36(d._B),e.Y36(h.s),e.Y36(l.F0),e.Y36(g.a))},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-service-discovery-list"]],decls:8,vars:7,consts:[[1,""],[1,"list-header","pl-btnbase","pr-btnrbase","py-btnybase","flex","flex-nowrap","items-center","justify-between"],["eo-ng-button","","eoNgUserAccess","upstream/discovery",1,"ant-btn-primary",3,"disabledEdit","click"],[1,"inline-block",3,"eoInputVal","eoClick"],["type","text","eo-ng-input","","placeholder","\u641c\u7d22\u670d\u52a1\u540d\u79f0",1,"search",3,"ngModel","ngModelChange","keyup.enter"],[1,"list-content"],[1,"",3,"nzTbody","nzThead","nzData","nzTrClick","nzMaxOperatorButton"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"button",2),e.NdJ("disabledEdit",function(r){return s.disabledEdit(r)})("click",function(){return s.addService()}),e._uU(3," \u65b0\u5efa\u670d\u52a1 "),e.qZA(),e.TgZ(4,"eo-ng-search-input-group",3),e.NdJ("eoClick",function(){return s.serviceNameForSear="",s.getServicesList()}),e.TgZ(5,"input",4),e.NdJ("ngModelChange",function(r){return s.serviceNameForSear=r})("keyup.enter",function(){return s.getServicesList()}),e.qZA()()(),e.TgZ(6,"div",5),e._UZ(7,"eo-ng-apinto-table",6),e.qZA()()),2&t&&(e.xp6(4),e.Q6J("eoInputVal",s.serviceNameForSear),e.xp6(1),e.Q6J("ngModel",s.serviceNameForSear),e.xp6(2),e.Q6J("nzTbody",s.servicesTableBody)("nzThead",s.servicesTableHeadName)("nzData",s.servicesList)("nzTrClick",s.serviceTableClick)("nzMaxOperatorButton",2))},dependencies:[c.Fj,c.JJ,c.On,A.h,C.oO,F.qK,b.g,_.a],encapsulation:2}),i})(),K=(()=>{class i{constructor(t,s,a){this.router=t,this.baseInfo=s,this.activateInfo=a,this.serviceName=""}ngOnInit(){this.serviceName=this.baseInfo.allParamsInfo.discoveryName,this.serviceName||this.router.navigate(["/"])}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.F0),e.Y36(v.D),e.Y36(l.gz))},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-service-discovery-message"]],decls:1,vars:2,consts:[[3,"editPage","serviceName"]],template:function(t,s){1&t&&e._UZ(0,"eo-ng-service-discovery-create",0),2&t&&e.Q6J("editPage",!0)("serviceName",s.serviceName)},dependencies:[N],encapsulation:2}),i})();var L=o(3845),Z=o(5710);const $=["clusterStatusTpl"];function ee(i,n){1&i&&e._UZ(0,"eo-ng-table-status",4),2&i&&e.Q6J("status",n.item.status)}let te=(()=>{class i{constructor(t,s,a,r,m,u){this.baseInfo=t,this.message=s,this.api=a,this.router=r,this.appConfigService=m,this.publishFailModal=u,this.nowUrl=this.router.routerState.snapshot.url,this.nzDisabled=!1,this.serviceName="",this.errorMessageId="",this.type="",this.failmsg="",this.solutionRouter="",this.solutionParam={},this.clustersList=[],this.clustersTableHeadName=[...f._b],this.clustersTableBody=[...f.U4],this.appConfigService.reqFlashBreadcrumb([{title:"\u670d\u52a1\u53d1\u73b0",routerLink:"upstream/discovery"},{title:"\u4e0a\u7ebf\u7ba1\u7406"}])}ngOnInit(){this.serviceName=this.baseInfo.allParamsInfo.discoveryName,this.serviceName||this.router.navigate(["/"]),this.getClustersData()}ngAfterViewInit(){this.clustersTableBody[2].title=this.clusterStatusTpl,this.clustersTableBody[5].btns[0].disabledFn=()=>this.nzDisabled,this.clustersTableBody[5].btns[0].click=t=>{this.updateOrOnline(t.data,"\u66f4\u65b0")},this.clustersTableBody[5].btns[1].disabledFn=()=>this.nzDisabled,this.clustersTableBody[5].btns[1].click=t=>{this.offline(t.data)},this.clustersTableBody[6].btns[0].disabledFn=()=>this.nzDisabled,this.clustersTableBody[6].btns[0].click=t=>{this.offline(t.data)},this.clustersTableBody[7].btns[0].disabledFn=()=>this.nzDisabled,this.clustersTableBody[7].btns[0].click=t=>{this.updateOrOnline(t.data,"\u4e0a\u7ebf")}}getClustersData(){this.api.get("discovery/"+this.serviceName+"/onlines").subscribe(t=>{0===t.code&&(this.clustersList=t.data.clusters)})}updateOrOnline(t,s){this.solutionRouter="",this.solutionParam={},this.api.put("discovery/"+this.serviceName+"/online",{clusterName:t.name||""}).subscribe(a=>{0===a.code?(this.message.success(a.msg||s+"\u6210\u529f",{nzDuration:1e3}),this.getClustersData()):(this.errorMessageId&&(this.message.remove(this.errorMessageId),this.errorMessageId=""),this.type=s,this.failmsg=a.msg,this.solutionRouter=a.data?.router?.name?a.data.router.name:"",this.solutionParam=a.data?.router?.params?a.data.router.params:{},this.solutionRouter?this.publishFailModal.openModal(a.msg,"\u670d\u52a1",this.solutionRouter,this.solutionParam):this.message.error(a.msg||s+"\u5931\u8d25"))})}closeErrorBtn(){this.message.remove(this.errorMessageId),this.errorMessageId=""}disabledEdit(t){this.nzDisabled=t}offline(t){this.solutionRouter="",this.solutionParam={},this.api.put("discovery/"+this.serviceName+"/offline",{clusterName:t.name||""}).subscribe(s=>{0===s.code?(this.getClustersData(),this.message.success(s.msg||"\u4e0b\u7ebf\u6210\u529f",{nzDuration:1e3})):(this.errorMessageId&&(this.message.remove(this.errorMessageId),this.errorMessageId=""),this.type="\u4e0b\u7ebf",this.failmsg=s.msg,this.message.error(s.msg||"\u4e0b\u7ebf\u5931\u8d25"))})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(v.D),e.Y36(d.VY),e.Y36(h.s),e.Y36(l.F0),e.Y36(g.a),e.Y36(L.i))},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-service-discovery-publish"]],viewQuery:function(t,s){if(1&t&&e.Gf($,7,e.Rgc),2&t){let a;e.iGM(a=e.CRH())&&(s.clusterStatusTpl=a.first)}},decls:5,vars:4,consts:[[1,""],[1,"list-content","tab-list"],["eoNgUserAccess","upstream/discovery",1,"",3,"nzTbody","nzThead","nzData","nzMaxOperatorButton","disabledEdit"],["clusterStatusTpl",""],[3,"status"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"eo-ng-apinto-table",2),e.NdJ("disabledEdit",function(r){return s.disabledEdit(r)}),e.qZA()()(),e.YNc(3,ee,1,1,"ng-template",null,3,e.W1O)),2&t&&(e.xp6(2),e.Q6J("nzTbody",s.clustersTableBody)("nzThead",s.clustersTableHeadName)("nzData",s.clustersList)("nzMaxOperatorButton",2))},dependencies:[Z.q,b.g,_.a],encapsulation:2}),i})(),se=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-service-discovery"]],decls:1,vars:0,template:function(t,s){1&t&&e._UZ(0,"router-outlet")},dependencies:[l.lC],encapsulation:2}),i})();const ie=["tab1Tpl"],ae=["tab2Tpl"],ne=["tab3Tpl"];function re(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"\u63a5\u53e3\u7ba1\u7406"),e.qZA())}function oe(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"\u4e0a\u7ebf\u7ba1\u7406"),e.qZA())}function ce(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"\u4e0a\u6e38\u4fe1\u606f"),e.qZA())}let le=(()=>{class i{constructor(t,s,a,r,m,u){this.router=t,this.baseInfo=s,this.activateInfo=a,this.cdRef=r,this.elem=m,this.renderer=u,this.tab1Tpl="\u73af\u5883\u53d8\u91cf",this.tab2Tpl="\u8bc1\u4e66\u7ba1\u7406",this.tab3Tpl="\u7f51\u5173\u8282\u70b9",this.serviceName="",this.options=[],this.tabOptions=[],this.selectedIndex=0,this.nowUrl=this.router.routerState.snapshot.url}ngOnInit(){this.serviceName=this.baseInfo.allParamsInfo.serviceName,this.serviceName||this.router.navigate(["/"])}ngAfterViewInit(){this.tabOptions=[{title:this.tab2Tpl,routerLink:"publish",queryParamsHandling:"merge"},{title:this.tab3Tpl,routerLink:"message",queryParamsHandling:"merge"}],this.cdRef.detectChanges()}ngAfterViewChecked(){const t=this.elem.nativeElement.querySelector("[nz-tabs-ink-bar]");this.renderer.removeAttribute(t,"hidden")}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.F0),e.Y36(v.D),e.Y36(l.gz),e.Y36(e.sBO),e.Y36(e.SBq),e.Y36(e.Qsj))},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-upstream-content"]],viewQuery:function(t,s){if(1&t&&(e.Gf(ie,7,e.Rgc),e.Gf(ae,7,e.Rgc),e.Gf(ne,7,e.Rgc)),2&t){let a;e.iGM(a=e.CRH())&&(s.tab1Tpl=a.first),e.iGM(a=e.CRH())&&(s.tab2Tpl=a.first),e.iGM(a=e.CRH())&&(s.tab3Tpl=a.first)}},decls:10,vars:3,consts:[[1,"content-tabs-fixed"],[3,"nzLinkRouter","nzSelectedIndex","nzOptions","nzSelectedIndexChange"],["tab1Tpl",""],["tab2Tpl",""],["tab3Tpl",""],[1,"inside-content-fixed-top-51"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"eo-ng-tabs",1),e.NdJ("nzSelectedIndexChange",function(r){return s.selectedIndex=r}),e.qZA(),e.YNc(2,re,2,0,"ng-template",null,2,e.W1O),e.YNc(4,oe,2,0,"ng-template",null,3,e.W1O),e.YNc(6,ce,2,0,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(8,"div",5),e._UZ(9,"router-outlet"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("nzLinkRouter",!0)("nzSelectedIndex",s.selectedIndex)("nzOptions",s.tabOptions))},dependencies:[z.n4,l.lC],encapsulation:2}),i})();const me=["environmentRef"];function ue(i,n){1&i&&(e.ynx(0),e._uU(1,"\u82f1\u6587\u6570\u5b57\u4e0b\u5212\u7ebf\u4efb\u610f\u4e00\u79cd\uff0c\u9996\u5b57\u6bcd\u5fc5\u987b\u4e3a\u82f1\u6587"),e.BQk())}function de(i,n){1&i&&(e.ynx(0),e._uU(1,"\u5fc5\u586b\u9879"),e.BQk())}function pe(i,n){if(1&i&&(e.YNc(0,ue,2,0,"ng-container",22),e.YNc(1,de,2,0,"ng-container",22)),2&i){const t=n.$implicit;e.Q6J("ngIf",t.hasError("pattern")),e.xp6(1),e.Q6J("ngIf",t.hasError("required"))}}let I=(()=>{class i{constructor(t,s,a,r,m){this.message=t,this.api=s,this.router=a,this.fb=r,this.appConfigService=m,this.editPage=!1,this.serviceName="",this.baseData=null,this.createUpstreamForm={name:"",desc:"",scheme:"HTTP",balance:"round-robin",discoveryName:"static",timeout:100,config:{addrsVariable:"",useVariable:!1,serviceName:"",staticConf:[{weight:null,addr:""}]}},this.schemeList=[...w],this.balanceList=[...G],this.discoveryList=[],this.useEnvVar=!1,this.autoTips=f.Sm,this.submitButtonLoading=!1,this.startValidateDynamic=!1,this.validateForm=new c.cw({}),this.nzDisabled=!1,this._baseData=null,this.showDynamicTips=!1,this.canBeSave=!1,this.validateForm=this.fb.group({name:["",[c.kI.required,c.kI.pattern("^[a-zA-Z][a-zA-Z0-9/_]*")]],desc:[""],scheme:["HTTP",[c.kI.required]],balance:["round-robin",[c.kI.required]],discoveryName:["static",[c.kI.required]],timeout:[100,[c.kI.required]]}),this.appConfigService.reqFlashBreadcrumb([{title:"\u4e0a\u6e38\u7ba1\u7406",routerLink:"upstream/upstream"},{title:"\u521b\u5efa\u4e0a\u6e38"}])}ngOnInit(){this.editPage?(this.getUpstreamMessage(),this.appConfigService.reqFlashBreadcrumb([{title:"\u4e0a\u6e38\u7ba1\u7406",routerLink:"upstream/upstream"},{title:"\u4e0a\u6e38\u4fe1\u606f"}])):this.getDiscovery()}getDiscovery(){this.api.get("discovery/enum").subscribe(t=>{if(0===t.code){for(const s in t.data.discoveries)this.discoveryList.push("static"!==t.data.discoveries[s].driver?{label:`${t.data.discoveries[s].name}[${t.data.discoveries[s].driver}]`,value:t.data.discoveries[s].name,render:t.data.discoveries[s].render}:{label:"\u9759\u6001\u8282\u70b9",value:t.data.discoveries[s].name,render:t.data.discoveries[s].render}),t.data.discoveries[s].name===this.validateForm.controls.discoveryName.value&&(this.baseData=t.data.discoveries[s].render);this.discoveryList=[...this.discoveryList]}})}changeBasedata(){this.discoveryList.forEach(t=>{this.validateForm.controls.discoveryName.value===t.value&&(this.baseData=t.render)})}disabledEdit(t){this.nzDisabled=t}getUpstreamMessage(){this.api.get("service",{name:this.serviceName}).subscribe(t=>{0===t.code&&(this.validateForm.controls.name.setValue(t.data.service.name),this.validateForm.controls.desc.setValue(t.data.service.desc),this.validateForm.controls.scheme.setValue(t.data.service.scheme),this.validateForm.controls.balance.setValue(t.data.service.balance),this.validateForm.controls.discoveryName.setValue(t.data.service.discoveryName),this.validateForm.controls.timeout.setValue(t.data.service.timeout),this.validateForm.controls.name.disable(),this.createUpstreamForm=t.data.service,this.createUpstreamForm.config.serviceName=this.createUpstreamForm.config.serviceName?this.createUpstreamForm.config.serviceName:"",this.createUpstreamForm.config.useVariable=!!this.createUpstreamForm.config.useVariable&&this.createUpstreamForm.config.useVariable,this.createUpstreamForm.config.addrsVariable=this.createUpstreamForm.config.addrsVariable?this.createUpstreamForm.config.addrsVariable:"",(!this.createUpstreamForm.config.staticConf||0===this.createUpstreamForm.config.staticConf.length)&&(this.createUpstreamForm.config.staticConf=[{addr:"",weight:null}]),this.getDiscovery())})}getDataFromDynamicComponent(t){if(t&&"static"===this.validateForm.controls.discoveryName.value){if(t.config.useVariable&&!t.config.addrsVariable)return void(this.canBeSave=!1);if(!t.config.useVariable){let s=!1;for(const a in t.config.staticConf)t.config.staticConf[a].addr&&""!==t.config.staticConf[a].addr&&t.config.staticConf[a].weight>0&&t.config.staticConf[a].weight<1e3&&(s=!0);if(!s)return void(this.canBeSave=!1)}}else if(!t.config.serviceName)return void(this.canBeSave=!1);this.canBeSave=!0}checkTimeout(){null!==this.validateForm.controls.timeout.value&&this.validateForm.controls.timeout.value<1&&this.validateForm.controls.timeout.setValue(1)}saveUpstream(){if(this.startValidateDynamic=!0,this.showDynamicTips=!this.canBeSave,(this.validateForm.valid||this.checkValidForm())&&this.canBeSave){if(this.createUpstreamForm.config.useVariable=null!==this.createUpstreamForm.config.useVariable&&this.createUpstreamForm.config.useVariable,this.createUpstreamForm.config.addrsVariable=null!==this.createUpstreamForm.config.addrsVariable?this.createUpstreamForm.config.addrsVariable:"",this.createUpstreamForm.config.serviceName=null!==this.createUpstreamForm.config.serviceName?this.createUpstreamForm.config.serviceName:"",this.createUpstreamForm.config.useVariable=null!==this.createUpstreamForm.config.useVariable&&this.createUpstreamForm.config.useVariable,this.createUpstreamForm.config.staticConf.length>0)for(const t in this.createUpstreamForm.config.staticConf)this.createUpstreamForm.config.staticConf[t].weight=Number(this.createUpstreamForm.config.staticConf[t].weight),this.createUpstreamForm.config.staticConf[t].addr=null===this.createUpstreamForm.config.staticConf[t].addr?"":this.createUpstreamForm.config.staticConf[t].addr;this.createUpstreamForm.timeout=Number(this.createUpstreamForm.timeout),this.submitButtonLoading=!0,this.editPage?this.api.put("service",{...this.validateForm.value,name:this.validateForm.controls.name.value,config:this.createUpstreamForm.config},{name:this.validateForm.controls.name.value}).subscribe(t=>{this.submitButtonLoading=!1,0===t.code&&(this.message.success(t.msg||"\u4fee\u6539\u670d\u52a1\u6210\u529f!",{nzDuration:1e3}),this.backToList())}):this.api.post("service",{...this.validateForm.value,config:this.createUpstreamForm.config}).subscribe(t=>{this.submitButtonLoading=!1,0===t.code&&(this.message.success(t.msg||"\u65b0\u5efa\u670d\u52a1\u6210\u529f!",{nzDuration:1e3}),this.backToList())})}else Object.values(this.validateForm.controls).forEach(t=>{t.invalid&&(t.markAsDirty(),t.updateValueAndValidity({onlySelf:!0}))})}checkValidForm(){for(const t in this.validateForm.controls)if(this.validateForm.controls[t].invalid)return!1;return!0}backToList(){this.router.navigate(["/","upstream","upstream"])}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(d.VY),e.Y36(h.s),e.Y36(l.F0),e.Y36(c.QS),e.Y36(g.a))},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-upstream-create"]],viewQuery:function(t,s){if(1&t&&e.Gf(me,7,e.Rgc),2&t){let a;e.iGM(a=e.CRH())&&(s.environmentRef=a.first)}},inputs:{editPage:"editPage",serviceName:"serviceName"},decls:54,vars:16,consts:[[1,"mt-formtop","w-[700px]","ml-auto","mr-auto"],["nz-form","","autocomplete","off",3,"nzNoColon","nzAutoTips","formGroup"],[1,"form-row"],[1,"w-[110px]","leading-[32px]","text-right"],[1,"required-symbol"],[1,"form-input",3,"nzErrorTip"],["name","name","eoNgUserAccess","upstream/upstream","required","","eo-ng-input","","formControlName","name","placeholder","\u82f1\u6587\u6570\u5b57\u4e0b\u5212\u7ebf\u4efb\u610f\u4e00\u79cd\uff0c\u9996\u5b57\u6bcd\u5fc5\u987b\u4e3a\u82f1\u6587",1,"w-INPUT_NORMAL"],["nameErrorTpl",""],[1,"form-input"],["name","desc","rows","6","eo-ng-input","","formControlName","desc","eoNgUserAccess","upstream/upstream","placeholder","\u8bf7\u8f93\u5165",1,"w-INPUT_NORMAL"],["name","scheme","required","","formControlName","scheme","eoNgUserAccess","upstream/upstream",1,"w-INPUT_NORMAL",3,"nzOptions","nzDisabled","disabledEdit"],["name","balance","required","","formControlName","balance",1,"w-INPUT_NORMAL",3,"nzOptions","nzDisabled"],["name","discoveryName","required","","formControlName","discoveryName",1,"w-INPUT_NORMAL",3,"nzOptions","nzDisabled","ngModelChange"],[1,"mb-[8px]"],[1,"dynamic-control"],["ngDefaultControl","","name","dynamic","id","dynamic",3,"apiData","baseData","nzDisabled","startValidate","apiDataChange"],[1,"form-row","mb-0"],["nzExtra","\u5355\u4f4d\uff1ams\uff0c\u6700\u5c0f\u503c\uff1a1",1,"form-input"],["type","number","name","timeout","required","","eo-ng-input","","formControlName","timeout","placeholder","\u8bf7\u8f93\u5165","eoNgUserAccess","upstream/upstream",1,"w-INPUT_NORMAL",3,"change"],[1,"mb-0","sticky","bg-white","bottom-0","py-mbase","z-50"],["eoNgUserAccess","upstream/upstream","type","submit","eo-ng-button","",1,"ant-btn-primary",3,"nzLoading","click"],["eo-ng-button","",1,"ml-btnybase",3,"click"],[4,"ngIf"]],template:function(t,s){if(1&t&&(e.TgZ(0,"div",0)(1,"form",1)(2,"nz-form-item",2)(3,"label",3)(4,"span",4),e._uU(5,"*"),e.qZA(),e._uU(6,"\u4e0a\u6e38\u670d\u52a1\u540d\u79f0\uff1a"),e.qZA(),e.TgZ(7,"nz-form-control",5),e._UZ(8,"input",6),e.YNc(9,pe,2,2,"ng-template",null,7,e.W1O),e.qZA()(),e.TgZ(11,"nz-form-item",2)(12,"label",3),e._uU(13,"\u63cf\u8ff0\uff1a"),e.qZA(),e.TgZ(14,"nz-form-control",8),e._UZ(15,"textarea",9),e.qZA()(),e.TgZ(16,"nz-form-item",2)(17,"label",3)(18,"span",4),e._uU(19,"*"),e.qZA(),e._uU(20,"\u8bf7\u6c42\u534f\u8bae\uff1a"),e.qZA(),e.TgZ(21,"nz-form-control",8)(22,"eo-ng-select",10),e.NdJ("disabledEdit",function(r){return s.disabledEdit(r)}),e.qZA()()(),e.TgZ(23,"nz-form-item",2)(24,"label",3)(25,"span",4),e._uU(26,"*"),e.qZA(),e._uU(27,"\u8d1f\u8f7d\u7b97\u6cd5\uff1a"),e.qZA(),e.TgZ(28,"nz-form-control",8),e._UZ(29,"eo-ng-select",11),e.qZA()(),e.TgZ(30,"nz-form-item",2)(31,"label",3)(32,"span",4),e._uU(33,"*"),e.qZA(),e._uU(34,"\u670d\u52a1\u53d1\u73b0\uff1a"),e.qZA(),e.TgZ(35,"nz-form-control",8)(36,"eo-ng-select",12),e.NdJ("ngModelChange",function(){return s.changeBasedata()}),e.qZA()()(),e.TgZ(37,"nz-form-item",13)(38,"nz-form-control",14)(39,"dynamic-component",15),e.NdJ("apiDataChange",function(r){return s.createUpstreamForm=r})("apiDataChange",function(r){return s.getDataFromDynamicComponent(r)}),e.qZA()()(),e.TgZ(40,"nz-form-item",16)(41,"label",3)(42,"span",4),e._uU(43,"*"),e.qZA(),e._uU(44,"\u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\uff1a"),e.qZA(),e.TgZ(45,"nz-form-control",17)(46,"input",18),e.NdJ("change",function(){return s.checkTimeout()}),e.qZA()()(),e.TgZ(47,"nz-form-item",19),e._UZ(48,"div",3),e.TgZ(49,"nz-form-control",8)(50,"button",20),e.NdJ("click",function(){return s.saveUpstream()}),e._uU(51),e.qZA(),e.TgZ(52,"button",21),e.NdJ("click",function(){return s.backToList()}),e._uU(53," \u53d6\u6d88 "),e.qZA()()()()()),2&t){const a=e.MAs(10);e.xp6(1),e.Q6J("nzNoColon",!0)("nzAutoTips",s.autoTips)("formGroup",s.validateForm),e.xp6(6),e.Q6J("nzErrorTip",a),e.xp6(15),e.Q6J("nzOptions",s.schemeList)("nzDisabled",s.nzDisabled),e.xp6(7),e.Q6J("nzOptions",s.balanceList)("nzDisabled",s.nzDisabled),e.xp6(7),e.Q6J("nzOptions",s.discoveryList)("nzDisabled",s.nzDisabled),e.xp6(3),e.Q6J("apiData",s.createUpstreamForm)("baseData",s.baseData)("nzDisabled",s.nzDisabled)("startValidate",s.startValidateDynamic),e.xp6(11),e.Q6J("nzLoading",s.submitButtonLoading),e.xp6(1),e.hij(" ",s.editPage?"\u63d0\u4ea4":"\u4fdd\u5b58"," ")}},dependencies:[T.O5,D.Hf,c._Y,c.Fj,c.wV,c.JJ,c.JL,c.Q7,U._,C.oO,F.qK,y.t3,y.SK,p.Lr,p.Nx,p.Fd,c.sg,c.u,b.g]}),i})(),he=(()=>{class i{constructor(t,s,a,r,m){this.message=t,this.modalService=s,this.api=a,this.router=r,this.appConfigService=m,this.nzDisabled=!1,this.upstreamName="",this.upstreamNameForSear="",this.upstreamsList=[],this.upstreamsTableHeadName=[...x],this.upstreamsTableBody=[...H],this.pageSize=20,this.pageNum=1,this.total=0,this.upstreamTableClick=u=>{this.router.navigate(["/","upstream","upstream","content",u.data.name])},this.appConfigService.reqFlashBreadcrumb([{title:"\u4e0a\u6e38\u7ba1\u7406",routerLink:"upstream/upstream"}])}ngOnInit(){this.getUpstreamsList(),this.upstreamsTableBody[5].btns[0].click=t=>{this.router.navigate(["/","upstream","upstream","content",t.data.name])},this.upstreamsTableBody[5].btns[1].disabledFn=(t,s)=>this.nzDisabled||!s.data.isDelete,this.upstreamsTableBody[5].btns[1].click=t=>{this.delete(t.data)}}getUpstreamsList(){this.api.get("services",{name:this.upstreamNameForSear,pageSize:this.pageSize,pageNum:this.pageNum}).subscribe(t=>{0===t.code&&(this.upstreamsList=t.data.services,this.total=t.data.total,this.upstreamName=this.upstreamNameForSear)})}addUpstream(){this.router.navigate(["/","upstream","upstream","create"])}delete(t,s){s?.stopPropagation(),this.modalService.create({nzTitle:"\u5220\u9664",nzContent:"\u8be5\u6570\u636e\u5220\u9664\u540e\u5c06\u65e0\u6cd5\u627e\u56de\uff0c\u8bf7\u786e\u8ba4\u662f\u5426\u5220\u9664\uff1f",nzClosable:!0,nzClassName:"delete-modal",nzOkDanger:!0,nzWidth:B.G_,nzOnOk:()=>{this.deleteService(t)}})}disabledEdit(t){this.nzDisabled=t}deleteService(t){this.api.delete("service",{name:t.name}).subscribe(s=>{0===s.code&&(this.getUpstreamsList(),this.message.success(s.msg||"\u5220\u9664\u6210\u529f!",{nzDuration:1e3}))})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(d.VY),e.Y36(d._B),e.Y36(h.s),e.Y36(l.F0),e.Y36(g.a))},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-upstream-list"]],decls:8,vars:12,consts:[[1,""],[1,"list-header","pl-btnbase","pr-btnrbase","py-btnybase","flex","flex-nowrap","items-center","justify-between"],["eo-ng-button","","eoNgUserAccess","upstream/upstream",1,"ant-btn-primary",3,"disabledEdit","click"],[1,"inline-block",3,"eoInputVal","eoClick"],["type","text","eo-ng-input","","placeholder","\u641c\u7d22\u4e0a\u6e38\u540d\u79f0",1,"search",3,"ngModel","ngModelChange","keyup.enter"],[1,"list-content","pb-[4px]"],[1,"",3,"nzTbody","nzThead","nzData","nzTrClick","nzMaxOperatorButton","nzShowPagination","nzFrontPagination","nzTotal","nzPageIndex","nzPageSize","nzPageIndexChange","nzPageSizeChange"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"button",2),e.NdJ("disabledEdit",function(r){return s.disabledEdit(r)})("click",function(){return s.addUpstream()}),e._uU(3," \u65b0\u5efa\u4e0a\u6e38 "),e.qZA(),e.TgZ(4,"eo-ng-search-input-group",3),e.NdJ("eoClick",function(){return s.upstreamNameForSear="",s.getUpstreamsList()}),e.TgZ(5,"input",4),e.NdJ("ngModelChange",function(r){return s.upstreamNameForSear=r})("keyup.enter",function(){return s.getUpstreamsList()}),e.qZA()()(),e.TgZ(6,"div",5)(7,"eo-ng-apinto-table",6),e.NdJ("nzPageIndexChange",function(r){return s.pageNum=r})("nzPageSizeChange",function(r){return s.pageSize=r})("nzPageIndexChange",function(){return s.getUpstreamsList()})("nzPageSizeChange",function(){return s.getUpstreamsList()}),e.qZA()()()),2&t&&(e.xp6(4),e.Q6J("eoInputVal",s.upstreamNameForSear),e.xp6(1),e.Q6J("ngModel",s.upstreamNameForSear),e.xp6(2),e.Q6J("nzTbody",s.upstreamsTableBody)("nzThead",s.upstreamsTableHeadName)("nzData",s.upstreamsList)("nzTrClick",s.upstreamTableClick)("nzMaxOperatorButton",2)("nzShowPagination",!0)("nzFrontPagination",!1)("nzTotal",s.total)("nzPageIndex",s.pageNum)("nzPageSize",s.pageSize))},dependencies:[c.Fj,c.JJ,c.On,A.h,C.oO,F.qK,b.g,_.a],encapsulation:2}),i})(),ge=(()=>{class i{constructor(t,s,a,r,m){this.baseInfo=t,this.api=s,this.appConfigService=a,this.router=r,this.activateInfo=m,this.nowUrl=this.router.routerState.snapshot.url,this.serviceName=""}ngOnInit(){this.serviceName=this.baseInfo.allParamsInfo.serviceName,this.serviceName||this.router.navigate(["/"])}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(v.D),e.Y36(h.s),e.Y36(g.a),e.Y36(l.F0),e.Y36(l.gz))},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-upstream-message"]],decls:1,vars:2,consts:[[3,"editPage","serviceName"]],template:function(t,s){1&t&&e._UZ(0,"eo-ng-upstream-create",0),2&t&&e.Q6J("editPage",!0)("serviceName",s.serviceName)},dependencies:[I],encapsulation:2}),i})();const ve=["clusterStatusTpl"];function fe(i,n){1&i&&e._UZ(0,"eo-ng-table-status",4),2&i&&e.Q6J("status",n.item.status)}let E=(()=>{class i{constructor(t,s,a,r,m,u){this.baseInfo=t,this.message=s,this.api=a,this.router=r,this.appConfigService=m,this.publishFailModal=u,this.nowUrl=this.router.routerState.snapshot.url,this.serviceName="",this.errorMessageId="",this.type="",this.failmsg="",this.solutionRouter="",this.solutionParam={},this.nzDisabled=!1,this.clustersList=[],this.clustersTableHeadName=[...f._b],this.clustersTableBody=[...f.U4],this.appConfigService.reqFlashBreadcrumb([{title:"\u4e0a\u6e38\u7ba1\u7406",routerLink:"upstream/upstream"},{title:"\u4e0a\u7ebf\u7ba1\u7406"}])}ngOnInit(){this.serviceName=this.baseInfo.allParamsInfo.serviceName,this.serviceName||this.router.navigate(["/","upstream","upstream"]),this.getClustersData()}ngAfterViewInit(){this.clustersTableBody[2].title=this.clusterStatusTpl,this.clustersTableBody[5].btns[0].disabledFn=()=>this.nzDisabled,this.clustersTableBody[5].btns[0].click=t=>{this.updateOrOnline(t.data,"\u66f4\u65b0")},this.clustersTableBody[5].btns[1].disabledFn=()=>this.nzDisabled,this.clustersTableBody[5].btns[1].click=t=>{this.offline(t.data)},this.clustersTableBody[6].btns[0].disabledFn=()=>this.nzDisabled,this.clustersTableBody[6].btns[0].click=t=>{this.offline(t.data)},this.clustersTableBody[7].btns[0].disabledFn=()=>this.nzDisabled,this.clustersTableBody[7].btns[0].click=t=>{this.updateOrOnline(t.data,"\u4e0a\u7ebf")}}getClustersData(){this.api.get("service/"+this.serviceName+"/onlines").subscribe(t=>{0===t.code&&(this.clustersList=t.data.clusters)})}disabledEdit(t){this.nzDisabled=t}updateOrOnline(t,s){this.solutionRouter="",this.solutionParam={},this.api.put("service/"+this.serviceName+"/online",{clusterName:t.name||""}).subscribe(a=>{0===a.code?(this.message.success(a.msg||s+"\u6210\u529f",{nzDuration:1e3}),this.getClustersData()):(this.errorMessageId&&(this.message.remove(this.errorMessageId),this.errorMessageId=""),this.type=s,this.failmsg=a.msg,this.solutionRouter=a.data?.router?.name?a.data.router.name:"",this.solutionParam=a.data?.router?.params?a.data.router.params:{},this.solutionRouter?this.publishFailModal.openModal(a.msg,"\u4e0a\u6e38\u670d\u52a1",this.solutionRouter,this.solutionParam):this.message.error(a.msg||s+"\u5931\u8d25"))})}closeErrorBtn(){this.message.remove(this.errorMessageId),this.errorMessageId=""}offline(t){this.solutionRouter="",this.solutionParam={},this.api.put("service/"+this.serviceName+"/offline",{clusterName:t.name||""}).subscribe(s=>{0===s.code?(this.message.success(s.msg||"\u4e0b\u7ebf\u6210\u529f!",{nzDuration:1e3}),this.getClustersData()):(this.errorMessageId&&(this.message.remove(this.errorMessageId),this.errorMessageId=""),this.type="\u4e0b\u7ebf",this.failmsg=s.msg,this.message.error(s.msg))})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(v.D),e.Y36(d.VY),e.Y36(h.s),e.Y36(l.F0),e.Y36(g.a),e.Y36(L.i))},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-upstream-publish"]],viewQuery:function(t,s){if(1&t&&e.Gf(ve,7,e.Rgc),2&t){let a;e.iGM(a=e.CRH())&&(s.clusterStatusTpl=a.first)}},decls:5,vars:5,consts:[[1,""],[1,"list-content","tab-list"],["eoNgUserAccess","upstream/upstream",1,"",3,"nzTbody","nzThead","nzData","nzMaxOperatorButton","nzNoScroll","disabledEdit"],["clusterStatusTpl",""],[3,"status"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"eo-ng-apinto-table",2),e.NdJ("disabledEdit",function(r){return s.disabledEdit(r)}),e.qZA()()(),e.YNc(3,fe,1,1,"ng-template",null,3,e.W1O)),2&t&&(e.xp6(2),e.Q6J("nzTbody",s.clustersTableBody)("nzThead",s.clustersTableHeadName)("nzData",s.clustersList)("nzMaxOperatorButton",2)("nzNoScroll",!0))},dependencies:[Z.q,b.g,_.a],encapsulation:2}),i})(),M=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["eo-ng-upstream"]],decls:1,vars:0,template:function(t,s){1&t&&e._UZ(0,"router-outlet")},dependencies:[l.lC],encapsulation:2}),i})();const be=[{path:"",component:M,data:{id:"2"},children:[{path:"upstream",component:M,data:{id:"201",parentId:"2"},children:[{path:"",component:he},{path:"create",component:I},{path:"content/:serviceName",component:le,children:[{path:"",component:E},{path:"publish",component:E},{path:"message",component:ge}]}]},{path:"discovery",component:se,data:{id:"202",parentId:"2"},children:[{path:"",component:W},{path:"create",component:N},{path:"content/:discoveryName",component:Y,children:[{path:"",component:te},{path:"message",component:K}]}]}]}];let Ce=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[l.Bz.forChild(be),l.Bz]}),i})();var Fe=o(6681),ye=o(3278),_e=o(7127),Te=o(8694),ze=o(8019),De=o(9356),Se=o(2129),Ue=o(8002),Ne=o(605),Be=o(1293),Ae=o(4383),Le=o(8213),Ze=o(7218),Ie=o(8284),Ee=o(5156),Me=o(269),Oe=o(7570),ke=o(2732),Pe=o(2968),Ve=o(7901),Ye=o(3111);let Je=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[De.pM,Se.XS,T.ez,Fe._,D.HO,c.u5,ke.D,Ne.Q7,d.hB,d.mx,z.iJ,_e.um,Me.HQ,C.FC,ye.YT,Be.Sn,ze.Hb,Te.l,Ue.r,Ae.Rt,F.r1,Pe.m,p.U5,c.UX,Ie.wm,Oe.cg,Le.Wr,y.Jb,Ee.Qp,Ze.C,Ve.Z,Ce,Ye.a]}),i})()}}]);