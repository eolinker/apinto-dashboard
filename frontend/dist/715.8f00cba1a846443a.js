"use strict";(self.webpackChunkapinto=self.webpackChunkapinto||[]).push([[715],{7715:(q,v,a)=>{a.r(v),a.d(v,{NavigationModule:()=>H});var g=a(6895),p=a(6152),f=a(9132),h=a(7504),_=a(9671),l=a(4006),Z=a(1461),c=a(1206),A=a(1042),n=a(4650),C=a(3),x=a(4963),z=a(3224),b=a(3679),m=a(6704),N=a(2366);function k(i,r){if(1&i&&(n.O4$(),n.TgZ(0,"svg",13),n._UZ(1,"use"),n.qZA()),2&i){const t=n.oxw(2);n.xp6(1),n.uIk("href","#"+t.iconSvg)}}function S(i,r){if(1&i&&(n.ynx(0),n._UZ(1,"div",11),n.YNc(2,k,2,1,"svg",12),n.BQk()),2&i){const t=n.oxw();n.xp6(2),n.Q6J("ngIf",t.iconSvg)}}function U(i,r){if(1&i&&(n.ynx(0),n._UZ(1,"img",14),n.BQk()),2&i){const t=n.oxw();n.xp6(1),n.Q6J("src",t.imageUrl,n.LSH)}}function J(i,r){if(1&i){const t=n.EpF();n.O4$(),n.TgZ(0,"svg",15),n.NdJ("click",function(o){n.CHM(t);const s=n.oxw();return n.KtG(s.deleteIcon(o))}),n._UZ(1,"use",16),n.qZA()}}function O(i,r){1&i&&(n.TgZ(0,"span"),n._uU(1,"\u5b50\u5bfc\u822a\u914d\u7f6e\uff1a"),n.qZA())}function D(i,r){if(1&i&&(n.TgZ(0,"nz-form-item")(1,"nz-form-label",3),n.YNc(2,O,2,0,"span",6),n.qZA(),n.TgZ(3,"nz-form-control",17)(4,"div",18),n.O4$(),n.TgZ(5,"svg",19),n._UZ(6,"use",20),n.qZA(),n.kcU(),n._UZ(7,"input",21),n.qZA()()()),2&i){const t=n.oxw(),e=t.first,o=t.index;n.xp6(1),n.Q6J("nzSpan",6),n.xp6(1),n.Q6J("ngIf",e),n.xp6(1),n.Q6J("nzSpan",14)("formGroupName",o)}}function I(i,r){if(1&i&&(n.ynx(0),n.YNc(1,D,8,4,"nz-form-item",6),n.BQk()),2&i){const t=n.oxw();n.xp6(1),n.Q6J("ngIf",t.editPage)}}const F=i=>new Promise((r,t)=>{const e=new FileReader;e.readAsDataURL(i),e.onload=()=>r(e.result),e.onerror=o=>t(o)});let M=(()=>{class i{get childArray(){return this.validateForm.get("children")}constructor(t,e,o){this.fb=t,this.api=e,this.message=o,this.autoTips=Z.Sm,this.validateForm=new l.cw({}),this.fileList=[],this.iconSvg="",this.editPage=!1,this.navigationUuid="",this.listOfControl=[],this.imageUrl="./assets/default-navigation-icon.png",this.beforeUpload=s=>(this.fileList=[],this.fileList=this.fileList.concat(s),this.handlerFileChange(),!1)}removeFile(){return this.fileList=[],!0}ngOnInit(){this.validateForm=this.fb.group({name:["",[l.kI.required]],children:this.fb.array([])}),this.editPage&&this.getNavMessage()}dataURLtoFile(t,e=""){const o=t.split(","),s=o[0].match(/:(.*?);/)[1],d=atob(o[1]);let u=d.length;const L=new Uint8Array(u);for(;u--;)L[u]=d.charCodeAt(u);return new File([L],e,{type:s})}getNavMessage(){this.api.get(`system/navigation/${this.navigationUuid}`).subscribe(t=>{if(0===t.code){this.validateForm.patchValue({name:t.data.navigation.title}),this.fileList="css"===t.data.navigation.iconType?[]:[this.dataURLtoFile(t.data.navigation.icon)],this.iconSvg="css"===t.data.navigation.iconType?t.data.navigation.icon:"",this.handlerFileChange();const e=this.validateForm.controls.children;t.data.navigation.modules.forEach(o=>{const s=new l.cw({});s.addControl("id",new l.NI(o.id)),s.addControl("title",new l.NI(o.title,[l.kI.required])),e.push(s)})}})}drop(t){const e=this.validateForm.controls.children.value;(0,c.bA)(e,t.previousIndex,t.currentIndex),this.validateForm.controls.children.setValue(e)}submit(){var t=this;return(0,_.Z)(function*(){if(t.validateForm.controls.name.invalid&&(t.validateForm.controls.name.markAsDirty(),t.validateForm.controls.name.updateValueAndValidity({onlySelf:!0})),t.editPage&&t.validateForm.controls.children.invalid)return t.validateForm.controls.children.markAsDirty(),void t.validateForm.controls.children.updateValueAndValidity({onlySelf:!0});if(t.validateForm.controls.name.invalid)return;const e=t.fileList.length?yield F(t.fileList[0]):t.iconSvg||"";t.editPage?t.api.put(`system/navigation/${t.navigationUuid}`,{name:t.validateForm.controls.name.value,icon:e,modules:t.validateForm.controls.children.value,iconType:t.iconSvg?"css":""}).subscribe(o=>{0===o.code&&(t.message.success(o.msg||"\u7f16\u8f91\u5bfc\u822a\u6210\u529f"),t.modalRef?.close())}):t.api.post("system/navigation",{name:t.validateForm.controls.name.value,icon:e,uuid:(0,A.Z)()}).subscribe(o=>{0===o.code&&(t.message.success(o.msg||"\u65b0\u5efa\u5bfc\u822a\u6210\u529f"),t.modalRef?.close())})})()}handlerFileChange(){var t=this;return(0,_.Z)(function*(){t.imageUrl=t.fileList.length?yield F(t.fileList[0]):"./assets/default-navigation-icon.png"})()}deleteIcon(t){t?.stopPropagation(),this.fileList=[],this.iconSvg="",this.handlerFileChange()}}return i.\u0275fac=function(t){return new(t||i)(n.Y36(l.QS),n.Y36(C.s),n.Y36(x.A))},i.\u0275cmp=n.Xpm({type:i,selectors:[["eo-ng-navigation-create"]],decls:18,vars:17,consts:[["nz-form","","autocomplete","off",3,"nzNoColon","nzAutoTips","formGroup"],[1,"form-row"],["nzRequired","",3,"nzSpan"],[3,"nzSpan"],["eo-ng-input","","name","name","required","","placeholder","\u8bf7\u8f93\u5165","formControlName","name",1,"w-INPUT_NORMAL"],["nzListType","picture-card","nzAccept","image/png",1,"picture-upload",3,"nzFileList","nzBeforeUpload","nzShowUploadList","nzLimit","nzRemove","nzSize","nzFileListChange","nzChange"],[4,"ngIf"],["class","delete-icon iconpark-icon absolute ml-[-10px] mt-[-5px] bg-[#fff] rounded-[50px] p-[2px] opacity-0 border-[1px] border-solid border-BORDER",3,"click",4,"ngIf"],[1,"ant-form-item-extra","activation-extra",2,"padding-left","0",3,"click"],["formArrayName","children","cdkDropList","",3,"cdkDropListDropped"],[4,"ngFor","ngForOf"],[1,"ant-upload-text"],["class","icon-image iconpark-icon h-[100%] w-[100%]",4,"ngIf"],[1,"icon-image","iconpark-icon","h-[100%]","w-[100%]"],[1,"icon-image",2,"width","100%","height","100%",3,"src"],[1,"delete-icon","iconpark-icon","absolute","ml-[-10px]","mt-[-5px]","bg-[#fff]","rounded-[50px]","p-[2px]","opacity-0","border-[1px]","border-solid","border-BORDER",3,"click"],["href","#guanbi"],["cdkDrag","",1,"child-navigation",3,"nzSpan","formGroupName"],[1,"flex","items-center"],["cdkDragHandle","",1,"cursor-pointer","iconpark-icon","border-[1px]","border-solid","border-color-base","mr-btnybase"],["href","#hamburger-button"],["eo-ng-input","","placeholder","placeholder","formControlName","title"]],template:function(t,e){1&t&&(n.TgZ(0,"form",0)(1,"nz-form-item",1)(2,"nz-form-label",2),n._uU(3,"\u5bfc\u822a\u540d\u79f0\uff1a"),n.qZA(),n.TgZ(4,"nz-form-control",3),n._UZ(5,"input",4),n.qZA()(),n.TgZ(6,"nz-form-item",1)(7,"nz-form-label",3),n._uU(8,"\u56fe\u6807\uff1a"),n.qZA(),n.TgZ(9,"nz-form-control",3)(10,"nz-upload",5),n.NdJ("nzFileListChange",function(s){return e.fileList=s})("nzFileListChange",function(){return e.handlerFileChange()})("nzChange",function(){return e.handlerFileChange()}),n.YNc(11,S,3,1,"ng-container",6),n.YNc(12,U,2,1,"ng-container",6),n.YNc(13,J,2,0,"svg",7),n.qZA(),n.TgZ(14,"div",8),n.NdJ("click",function(s){return s.stopPropagation()}),n._uU(15," \u8bf7\u4e0a\u4f2064*64px\u7684png\u56fe\u6807\uff0c\u5927\u5c0f100k\u4ee5\u5185 "),n.qZA()()(),n.TgZ(16,"div",9),n.NdJ("cdkDropListDropped",function(s){return e.drop(s)}),n.YNc(17,I,2,1,"ng-container",10),n.qZA()()),2&t&&(n.Q6J("nzNoColon",!0)("nzAutoTips",e.autoTips)("formGroup",e.validateForm),n.xp6(2),n.Q6J("nzSpan",6),n.xp6(2),n.Q6J("nzSpan",14),n.xp6(3),n.Q6J("nzSpan",6),n.xp6(2),n.Q6J("nzSpan",14),n.xp6(1),n.Q6J("nzFileList",e.fileList)("nzBeforeUpload",e.beforeUpload)("nzShowUploadList",!1)("nzLimit",1)("nzRemove",e.removeFile)("nzSize",100),n.xp6(1),n.Q6J("ngIf",!e.fileList.length),n.xp6(1),n.Q6J("ngIf",!e.iconSvg),n.xp6(1),n.Q6J("ngIf",e.iconSvg||e.fileList.length),n.xp6(4),n.Q6J("ngForOf",e.childArray.controls))},dependencies:[g.sg,g.O5,l._Y,l.Fj,l.JJ,l.JL,l.Q7,l.sg,l.u,l.x0,l.CE,z.FY,b.t3,b.SK,m.Lr,m.Nx,m.iK,m.Fd,N.oO,c.Wj,c.Zt,c.Bh],styles:["[_nghost-%COMP%]     .ant-upload.ant-upload-select-picture-card{height:64px;width:64px}[_nghost-%COMP%]     .ant-upload.ant-upload-select-picture-card [nz-upload-btn]{display:block}[_nghost-%COMP%]     .icon-image:hover+svg.delete-icon{opacity:1!important}[_nghost-%COMP%]     svg.delete-icon:hover{opacity:1!important;border:1px solid var(--primary-color)!important}[_nghost-%COMP%]     .child-navigation .ant-form-item-explain{margin-left:32px}"]}),i})();var Q=a(9561),B=a(2266),y=a(4162),T=a(7919);function P(i,r){1&i&&n._UZ(0,"eo-ng-empty")}function R(i,r){if(1&i&&(n.O4$(),n.TgZ(0,"svg",16),n._UZ(1,"use"),n.qZA()),2&i){const t=n.oxw().$implicit;n.xp6(1),n.uIk("href","#"+(t.icon||"daohang"))}}function w(i,r){if(1&i&&(n.O4$(),n.kcU(),n._UZ(0,"img",17)),2&i){const t=n.oxw().$implicit;n.Q6J("src",t.icon,n.LSH)}}function Y(i,r){if(1&i){const t=n.EpF();n.TgZ(0,"li",7)(1,"ul",8)(2,"nz-list-item-action")(3,"button",9),n.NdJ("click",function(){const s=n.CHM(t).$implicit,d=n.oxw(2);return n.KtG(d.openNavigationModal(!1,s.uuid))}),n._uU(4," \u7f16\u8f91 "),n.qZA(),n.TgZ(5,"button",10),n.NdJ("click",function(){const s=n.CHM(t).$implicit,d=n.oxw(2);return n.KtG(d.disableNavigationModal(s.uuid))}),n._uU(6," \u5220\u9664 "),n.qZA()()(),n.TgZ(7,"div",11),n.O4$(),n.TgZ(8,"svg",12),n._UZ(9,"use",13),n.qZA(),n.YNc(10,R,2,1,"svg",14),n.YNc(11,w,1,1,"img",15),n.kcU(),n.TgZ(12,"span"),n._uU(13),n.qZA()()()}if(2&i){const t=r.$implicit;n.xp6(5),n.Q6J("disabled",!t.canDelete),n.xp6(5),n.Q6J("ngIf",!t.icon||"css"===t.iconType),n.xp6(1),n.Q6J("ngIf",t.icon&&"css"!==t.iconType),n.xp6(2),n.Oqu(t.title)}}function E(i,r){if(1&i){const t=n.EpF();n.TgZ(0,"ul",5),n.NdJ("cdkDropListDropped",function(o){n.CHM(t);const s=n.oxw();return n.KtG(s.drop(o))}),n.YNc(1,Y,14,4,"li",6),n.qZA()}if(2&i){const t=n.oxw();n.Q6J("nzDataSource",t.navigationList),n.xp6(1),n.Q6J("ngForOf",t.navigationList)}}const $=function(i){return{"overflow-y-auto":i}},G=[{path:"",component:(()=>{class i{constructor(t,e,o,s){this.modalService=t,this.api=e,this.message=o,this.navigationService=s,this.navigationList=[],this.navigationService.reqFlashBreadcrumb([{title:"\u5bfc\u822a\u7ba1\u7406"}])}ngOnInit(){this.getNavigationList()}getNavigationList(){this.api.get("system/navigation").subscribe(t=>{0===t.code&&(this.navigationList=t.data.navigations)})}disableNavigationModal(t){this.modalRef=this.modalService.create({nzTitle:"\u5220\u9664",nzContent:"\u8be5\u6570\u636e\u5220\u9664\u540e\u5c06\u65e0\u6cd5\u627e\u56de\uff0c\u8bf7\u786e\u8ba4\u662f\u5426\u5220\u9664\uff1f",nzClosable:!0,nzClassName:"delete-modal",nzWidth:h.G_,nzOkText:"\u786e\u5b9a",nzOkDanger:!0,nzCancelText:"\u53d6\u6d88",nzOnOk:()=>(this.disableNavigation(t),!1)})}disableNavigation(t){this.api.delete(`system/navigation/${t}`).subscribe(e=>{0===e.code&&(this.message.success(e.msg||"\u5220\u9664\u6210\u529f"),this.modalRef?.close())})}openNavigationModal(t,e){this.modalRef=this.modalService.create({nzTitle:t?"\u65b0\u5efa\u5bfc\u822a":"\u7f16\u8f91\u5bfc\u822a",nzWidth:h.G_,nzContent:M,nzComponentParams:{...t?{}:{editPage:!t,navigationUuid:e},modalRef:this.modalRef},nzOnOk:o=>(o.submit(),!1)})}drop(t){const e=[...this.navigationList];(0,c.bA)(e,t.previousIndex,t.currentIndex),this.api.put("system/navigation",{navigations:e.map(o=>o.uuid)}).subscribe(o=>{0===o.code&&((0,c.bA)(this.navigationList,t.previousIndex,t.currentIndex),this.message.success(o.msg||"\u64cd\u4f5c\u6210\u529f"))})}}return i.\u0275fac=function(t){return new(t||i)(n.Y36(Q._B),n.Y36(C.s),n.Y36(x.A),n.Y36(B.a))},i.\u0275cmp=n.Xpm({type:i,selectors:[["eo-ng-navigation"]],decls:7,vars:5,consts:[[1,"list-header","pl-btnbase","pr-btnrbase","py-btnybase","flex","flex-nowrap","items-center","justify-between"],["eo-ng-button","",1,"ant-btn-primary",3,"click"],[1,"ml-btnbase","mr-btnrbase","w-[60%]","h-[calc(100%_-_64px)]",3,"ngClass"],[4,"ngIf"],["class","draggable-list","nz-list","","nzBordered","","nzSize","large","cdkDropList","",3,"nzDataSource","cdkDropListDropped",4,"ngIf"],["nz-list","","nzBordered","","nzSize","large","cdkDropList","",1,"draggable-list",3,"nzDataSource","cdkDropListDropped"],["class","draggable-item","nz-list-item","","nzNoFlex","","cdkDrag","","cdkDragBoundary",".draggable-list",4,"ngFor","ngForOf"],["nz-list-item","","nzNoFlex","","cdkDrag","","cdkDragBoundary",".draggable-list",1,"draggable-item"],["nz-list-item-actions",""],["eo-ng-button","",1,"ml-btnybase",3,"click"],["eo-ng-button","",1,"ml-btnybase",3,"disabled","click"],[1,"flex","items-center"],[1,"iconpark-icon","border-[1px]","border-solid","border-color-base","mr-btnybase"],["href","#hamburger-button"],["class","iconpark-icon mr-[5px]",4,"ngIf"],["class","iconpark-icon mr-[5px]",3,"src",4,"ngIf"],[1,"iconpark-icon","mr-[5px]"],[1,"iconpark-icon","mr-[5px]",3,"src"]],template:function(t,e){1&t&&(n.TgZ(0,"div",0)(1,"div")(2,"button",1),n.NdJ("click",function(){return e.openNavigationModal(!0)}),n._uU(3," \u65b0\u5efa\u5bfc\u822a "),n.qZA()()(),n.TgZ(4,"div",2),n.YNc(5,P,1,0,"eo-ng-empty",3),n.YNc(6,E,2,2,"ul",4),n.qZA()),2&t&&(n.xp6(4),n.Q6J("ngClass",n.VKq(3,$,e.navigationList.length)),n.xp6(1),n.Q6J("ngIf",!(null!=e.navigationList&&e.navigationList.length)),n.xp6(1),n.Q6J("ngIf",e.navigationList.length))},dependencies:[g.mk,g.sg,g.O5,p.n_,p.AA,p.nk,p.KC,y.qK,c.Wj,c.Zt,T.M],styles:["[_nghost-%COMP%]     .ant-list-bordered{border:1px solid var(--border-color)}[_nghost-%COMP%]     .ant-list-split .ant-list-item{border-bottom:1px solid var(--border-color)}[_nghost-%COMP%]     .draggable-list{display:block;border-radius:4px;overflow:hidden}[_nghost-%COMP%]     .draggable-item{display:flex;flex-direction:row;align-items:center;justify-content:space-between;cursor:move}[_nghost-%COMP%]     .cdk-drag-placeholder{opacity:0}[_nghost-%COMP%]     .cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}[_nghost-%COMP%]     .draggable-item:last-child{border:none}"]}),i})()}];let K=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=n.oAB({type:i}),i.\u0275inj=n.cJS({imports:[f.Bz.forChild(G),f.Bz]}),i})();var V=a(3111),j=a(2382);let H=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=n.oAB({type:i}),i.\u0275inj=n.cJS({imports:[g.ez,l.u5,l.UX,z.cS,K,p.Ph,m.U5,y.r1,V.a,N.FC,c._t,T.p,j.PV]}),i})()}}]);