"use strict";(self.webpackChunkapinto=self.webpackChunkapinto||[]).push([[14],{4014:(j,m,i)=>{i.r(m),i.d(m,{AuditLogModule:()=>R});var c=i(6895),h=i(9132),e=i(4650);let _=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=e.Xpm({type:a,selectors:[["eo-ng-audit-log"]],decls:1,vars:0,template:function(t,n){1&t&&e._UZ(0,"router-outlet")},dependencies:[h.lC],encapsulation:2}),a})();var D=i(7504);const A=[{label:"\u65b0\u5efa",value:"create"},{label:"\u7f16\u8f91",value:"edit"},{label:"\u5220\u9664",value:"delete"},{label:"\u53d1\u5e03",value:"publish"}],v=[{title:"\u7528\u6237\u540d",resizeable:!0},{title:"\u64cd\u4f5c\u7c7b\u578b",resizeable:!0},{title:"\u64cd\u4f5c\u5bf9\u8c61",resizeable:!0},{title:"\u64cd\u4f5c\u65f6\u95f4",resizeable:!0},{title:"\u64cd\u4f5cIP",resizeable:!0},{title:"\u64cd\u4f5c",right:!0}],k=[{key:"username",copy:!0},{key:"operateType"},{key:"kind"},{key:"time"},{key:"ip",copy:!0},{type:"btn",right:!0,btns:[{title:"\u67e5\u770b"}]}],M=[{title:"\u5c5e\u6027",resizeable:!0},{title:"\u914d\u7f6e"}],F=[{key:"attr",copy:!0},{key:"value",styleFn:a=>"\u8bf7\u6c42\u5185\u5bb9"===a.attr?"white-space: pre-wrap;word-wrap:break-word; word-break:break-all":"white-space: unset;word-wrap:break-word; word-break:break-all",ellipsis:!1,copy:!0,json:!0}];var u=i(9561),T=i(3),C=i(2663),L=i(9041);const B=["detailTdTpl"],w=function(a,l,t){return{"break-all":a,"whitespace-pre-wrap":l,"break-words":t}};function Z(a,l){if(1&a){const t=e.EpF();e.TgZ(0,"div",3)(1,"span",4),e._uU(2),e.qZA(),e.TgZ(3,"span",5),e.NdJ("copyCallback",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.copyCallback())})("click",function(o){return o.stopPropagation()}),e.O4$(),e.TgZ(4,"svg",6),e._UZ(5,"use",7),e.qZA()()()}if(2&a){const t=l.item;e.xp6(1),e.Q6J("nzTooltipTitle",t.value)("nzTooltipVisible",!1)("nzTooltipTrigger","hover")("nzTooltipOverlayClassName","\u8bf7\u6c42\u5185\u5bb9"===t.attr?"tooltip-json":"")("ngClass",e.kEZ(7,w,"\u8bf7\u6c42\u5185\u5bb9"===t.attr,"\u8bf7\u6c42\u5185\u5bb9"===t.attr,"\u8bf7\u6c42\u5185\u5bb9"===t.attr)),e.xp6(1),e.hij("",t.value," "),e.xp6(1),e.Q6J("copyText",t.value)}}let S=(()=>{class a{constructor(t,n){this.message=t,this.api=n,this.auditLogId="",this.auditLogDetail=[],this.auditLogDetailTableHeadName=[...M],this.auditLogDetailTableBody=[...F]}ngOnInit(){this.getLogDetail()}ngAfterViewInit(){this.auditLogDetailTableBody[1].title=this.detailTdTpl}getLogDetail(){this.api.get("audit-log",{logId:this.auditLogId}).subscribe(t=>{if(0===t.code){this.auditLogDetail=t.data.args;for(const n in this.auditLogDetail)"\u8bf7\u6c42\u5185\u5bb9"===this.auditLogDetail[n].attr&&(this.auditLogDetail[n].value=JSON.stringify(JSON.parse(this.auditLogDetail[n].value),null,4))}})}copyCallback(){this.message.success("\u590d\u5236\u6210\u529f",{nzDuration:1e3})}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(u.VY),e.Y36(T.s))},a.\u0275cmp=e.Xpm({type:a,selectors:[["eo-ng-audit-log-detail"]],viewQuery:function(t,n){if(1&t&&e.Gf(B,5),2&t){let o;e.iGM(o=e.CRH())&&(n.detailTdTpl=o.first)}},inputs:{auditLogId:"auditLogId"},decls:4,vars:4,consts:[[1,"drawer-list-content"],[1,"drawer-table","auth-log-table",3,"nzTbody","nzThead","nzData","nzNoScroll"],["detailTdTpl",""],[1,"leading-[22px]","flex","items-center"],["eoNgFeedbackTooltip","",1,"mr-[8px]","default-tpl-td-span","whitespace-pre-wrap","break-all","break-words",3,"nzTooltipTitle","nzTooltipVisible","nzTooltipTrigger","nzTooltipOverlayClassName","ngClass"],["eo-copy","","nzType","primary",1,"h-[20px]","leading-[22px]","text-[12px]","opacity-0","cursor-pointer","inline-flex","items-center",3,"copyText","copyCallback","click"],[1,"iconpark-icon"],["href","#copy"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"eo-ng-apinto-table",1),e.qZA(),e.YNc(2,Z,6,11,"ng-template",null,2,e.W1O)),2&t&&(e.xp6(1),e.Q6J("nzTbody",n.auditLogDetailTableBody)("nzThead",n.auditLogDetailTableHeadName)("nzData",n.auditLogDetail)("nzNoScroll",!0))},dependencies:[c.mk,C.a,u.Cl,L.jw],encapsulation:2}),a})();var O=i(2266),z=i(2366),b=i(4162),y=i(8344),d=i(4006),f=i(5259),P=i(7706);const N=["auditLogFormTpl"],J=[{path:"",component:_,data:{id:"7"},children:[{path:"",component:(()=>{class a{constructor(t,n,o,s){this.message=t,this.api=n,this.modalService=o,this.navigationService=s,this.logsList=[],this.logsTableHeadName=[...v],this.logsTableBody=[...k],this.auditLogDetail=[],this.date=[],this.listOfType=[...A],this.listOfKind=[],this.searchData={keyword:"",operateType:"",kind:"",start:null,end:null,pageSize:20,pageNum:1,total:0},this.logsTableClick=r=>{this.openDrawer(r.data.id)},this.navigationService.reqFlashBreadcrumb([{title:"Debug\u65e5\u5fd7"}])}ngOnInit(){this.logsTableBody[5].btns[0].click=t=>{this.openDrawer(t.data.id)},this.getLogList(),this.getTargetList()}getLogList(){const{start:t,end:n,kind:o,operateType:s,...r}=this.searchData;t&&(r.start=Math.floor(t.getTime()/1e3)),r.end=n?Math.floor(n.getTime()/1e3):Math.floor((new Date).getTime()/1e3),r.kind=o||"",r.operateType=s||"",this.api.get("audit-logs",r).subscribe(g=>{if(0===g.code){for(const p in g.data.items)g.data.items[p].username=g.data.items[p].operator.username,g.data.items[p].operateType=this.changeToChinese(g.data.items[p].operateType);this.logsList=g.data.items,this.searchData.total=g.data.total}})}getTargetList(){this.api.get("audit-log/kinds").subscribe(t=>{if(0===t.code){this.listOfKind=[];for(const n in t.data.items)this.listOfKind.push({label:t.data.items[n].title,value:t.data.items[n].name})}})}openDrawer(t){this.drawerRef=this.modalService.create({nzTitle:"\u65e5\u5fd7\u8be6\u60c5",nzWidth:D.iE,nzContent:S,nzComponentParams:{auditLogId:t},nzWrapClassName:"audit-log-drawer",nzOkText:null})}clearSearch(){this.searchData={keyword:"",operateType:"",kind:"",start:null,end:null,pageSize:20,pageNum:1,total:0},this.date=[]}onDateRangeChange(t){t&&(this.searchData.start=t[0],this.searchData.end=t[1])}changeToChinese(t){switch(t){case"create":return"\u65b0\u5efa";case"edit":default:return"\u7f16\u8f91";case"delete":return"\u5220\u9664";case"publish":return"\u53d1\u5e03"}}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(u.VY),e.Y36(T.s),e.Y36(u._B),e.Y36(O.a))},a.\u0275cmp=e.Xpm({type:a,selectors:[["eo-ng-audit-log-list"]],viewQuery:function(t,n){if(1&t&&e.Gf(N,7,e.Rgc),2&t){let o;e.iGM(o=e.CRH())&&(n.auditLogFormTpl=o.first)}},decls:23,vars:21,consts:[[1,""],[1,"list-header","pl-btnbase","pr-btnrbase","py-btnybase"],[1,"group-search-large"],["nzPlaceHolder","\u8bf7\u9009\u62e9",3,"ngModel","nzOptions","nzAllowClear","ngModelChange"],[1,"ml-btnybase","label"],[1,"inline-block",3,"eoSingle","eoInputVal","eoClick"],["type","text","eo-ng-input","","placeholder","\u8bf7\u8f93\u5165\u7528\u6237\u540d\u6216\u8bf7\u6c42IP",1,"search",3,"ngModel","ngModelChange"],["nzFormat","MM/dd HH:mm:ss",3,"nzShowTime","ngModel","ngModelChange"],["eo-ng-button","",1,"ml-btnybase",3,"click"],["eo-ng-button","",1,"ant-btn-primary","ml-btnybase",3,"click"],[1,"list-content","pb-[4px]"],[1,"",3,"nzTbody","nzThead","nzData","nzTrClick","nzMaxOperatorButton","nzShowPagination","nzFrontPagination","nzTotal","nzPageIndex","nzPageSize","nzPageIndexChange","nzPageSizeChange"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"label",0),e._uU(4,"\u64cd\u4f5c\u7c7b\u578b\uff1a"),e.qZA(),e.TgZ(5,"eo-ng-select",3),e.NdJ("ngModelChange",function(s){return n.searchData.operateType=s}),e.qZA(),e.TgZ(6,"label",4),e._uU(7,"\u64cd\u4f5c\u5bf9\u8c61\uff1a"),e.qZA(),e.TgZ(8,"eo-ng-select",3),e.NdJ("ngModelChange",function(s){return n.searchData.kind=s}),e.qZA(),e.TgZ(9,"label",4),e._uU(10,"\u641c\u7d22\u5185\u5bb9\uff1a"),e.qZA(),e.TgZ(11,"eo-ng-search-input-group",5),e.NdJ("eoClick",function(){return n.searchData.keyword="",n.getLogList()}),e.TgZ(12,"input",6),e.NdJ("ngModelChange",function(s){return n.searchData.keyword=s}),e.qZA()()(),e.TgZ(13,"div",2)(14,"label"),e._uU(15,"\u64cd\u4f5c\u65f6\u95f4\uff1a"),e.qZA(),e.TgZ(16,"nz-range-picker",7),e.NdJ("ngModelChange",function(s){return n.date=s})("ngModelChange",function(s){return n.onDateRangeChange(s)}),e.qZA(),e.TgZ(17,"button",8),e.NdJ("click",function(){return n.clearSearch()}),e._uU(18," \u91cd\u7f6e "),e.qZA(),e.TgZ(19,"button",9),e.NdJ("click",function(){return n.getLogList()}),e._uU(20," \u67e5\u8be2 "),e.qZA()()(),e.TgZ(21,"div",10)(22,"eo-ng-apinto-table",11),e.NdJ("nzPageIndexChange",function(s){return n.searchData.pageNum=s})("nzPageSizeChange",function(s){return n.searchData.pageSize=s})("nzPageIndexChange",function(){return n.getLogList()})("nzPageSizeChange",function(){return n.getLogList()}),e.qZA()()()),2&t&&(e.xp6(5),e.Q6J("ngModel",n.searchData.operateType)("nzOptions",n.listOfType)("nzAllowClear",!0),e.xp6(3),e.Q6J("ngModel",n.searchData.kind)("nzOptions",n.listOfKind)("nzAllowClear",!0),e.xp6(3),e.Q6J("eoSingle",!1)("eoInputVal",n.searchData.keyword),e.xp6(1),e.Q6J("ngModel",n.searchData.keyword),e.xp6(4),e.Q6J("nzShowTime",!0)("ngModel",n.date),e.xp6(6),e.Q6J("nzTbody",n.logsTableBody)("nzThead",n.logsTableHeadName)("nzData",n.logsList)("nzTrClick",n.logsTableClick)("nzMaxOperatorButton",1)("nzShowPagination",!0)("nzFrontPagination",!1)("nzTotal",n.searchData.total)("nzPageIndex",n.searchData.pageNum)("nzPageSize",n.searchData.pageSize))},dependencies:[z.oO,b.qK,y.Hf,d.Fj,d.JJ,d.On,f.uw,f.wS,P.h,C.a],styles:[".group-search-large[_ngcontent-%COMP%]{white-space:nowrap}.group-search-large[_ngcontent-%COMP%]:nth-child(2){margin-top:var(--LAYOUT_PADDING);display:flex;align-items:center}eo-ng-select.ant-select[_ngcontent-%COMP%], eo-ng-select-top-control.ant-select-selector[_ngcontent-%COMP%], nz-range-picker[_ngcontent-%COMP%], .group-search-large[_ngcontent-%COMP%]   eo-ng-input-group[_ngcontent-%COMP%]{width:254px!important;border-radius:var(--border-radius);min-height:32px}"]}),a})()}]}];let I=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[h.Bz.forChild(J),h.Bz]}),a})();var Q=i(8694),H=i(605),x=i(2732),U=i(3111),Y=i(5932);(0,c.qS)(Y.Z);let R=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[c.ez,I,z.FC,b.r1,y.HO,H.Q7,d.u5,d.UX,Q.l,x.D,U.a,u.mx,L.WF]}),a})()}}]);